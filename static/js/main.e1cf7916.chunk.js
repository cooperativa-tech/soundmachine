(this.webpackJsonp=this.webpackJsonp||[]).push([[0],[,function(e,n,t){"use strict";var r=new AudioContext,a=r.createScriptProcessor(4096,1,1);a.connect(r.destination);var o={audioContext:r,analyser:a,sourceNode:null,mediaRecorder:null,recording:null,chunks:[],pressedKeys:{},lastRecordingURL:null,lastRecordingBlob:null,sharingFocused:!1,mouthPosition:0};n.a=o},,,,function(e,n,t){"use strict";t.d(n,"a",function(){return o}),t.d(n,"b",function(){return c});var r=t(30),a=t(0),o=(t(2),function(e){var n=e.leftMargin,t=e.selected,o=e.hasRecording,c=e.isRecording,i=Object(r.a)(e,["leftMargin","selected","hasRecording","isRecording"]);return Object(a.c)("div",Object.assign({css:{width:70,height:70,display:"flex",alignItems:"center",justifyContent:"center",background:t&&c?"#E24E4E":o?"#0078F0":"#2D2D2D",boxShadow:o?"0px 12px 20px rgba(0, 120, 240, 0.28)":"0px 8px 20px rgba(22, 22, 22, 0.28)",boxSizing:"border-box",borderRadius:8,color:"#FFF",marginLeft:n?10:0,position:"relative",textTransform:"uppercase"}},i),Object(a.c)("span",null,i.keycode))}),c=function(e){return Object(a.c)("div",Object.assign({css:{display:"flex"}},e),e.children)}},,,function(e,n,t){"use strict";var r=new(t(28).a)("Button");r.version(1).stores({keys:"key"}),r.version(2).stores({keys:"key",keyboards:"hash"}),n.a=r},,,,,,,,,function(e,n,t){"use strict";t.d(n,"b",function(){return u}),t.d(n,"a",function(){return d});var r=t(3),a=t.n(r),o=t(4),c=t(29),i=!1,s=new(t.n(c).a);s.addEventListener("message",function(e){"ready"===e.data.message&&(i=!0)},{once:!0});var u=function(){var e=Object(o.a)(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return e.next=3,new Promise(function(e){setTimeout(function n(){i?e():setTimeout(n,200)},200)});case 3:return console.log("starting share"),s.postMessage({message:"share"}),e.abrupt("return",new Promise(function(e,n){s.addEventListener("message",function(t){var r=t.data;"share"===r.message?e(r.hash):n("invalid message received")},{once:!0})}));case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),d=function(){var e=Object(o.a)(a.a.mark(function e(n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i){e.next=3;break}return e.next=3,new Promise(function(e){setTimeout(function n(){i?e():setTimeout(n,200)},200)});case 3:return console.log("starting download"),s.postMessage({message:"download",hash:n}),e.abrupt("return",new Promise(function(e,n){s.addEventListener("message",function(t){var r=t.data;console.log("cko asiasdfksadf"),"download"===r.message?e():n("invalid message received")},{once:!0})}));case 6:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}()},,,,function(e,n,t){"use strict";(function(e){var r=t(22),a=t(11),o=t(12),c=t(14),i=t(13),s=t(15),u=t(3),d=t.n(u),l=t(9),f=t(4),p=t(6),b=t(7),h=t.n(b),g=t(2),m=t.n(g),v=t(0),y=t(16),O=t(5),w=t(24),j=t(27),k=t(1),x=t(8),R=t(17);function S(){var e=Object(r.a)(["\n              html,\n              body {\n                background-color: white;\n                color: #1b1b1b;\n                font-size: 18;\n                line-height: 1;\n                font-family: Arial;\n              }\n\n              body {\n                padding: 40px;\n              }\n            "]);return S=function(){return e},e}function C(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter(function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable})),t.push.apply(t,r)}return t}function L(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?C(t,!0).forEach(function(n){Object(l.a)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):C(t).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var D=["q","w","e","r","t","y","u","i","o","p"],E=["a","s","d","f","g","h","j","k","l"],P=["z","x","c","v","b","n","m"],F=[].concat(D,E,P),K=function(e){var n,t=[],r=new RegExp("(?:\\?|&)"+e+"=(.*?)(?=&|$)","gi");for(;null!==(n=r.exec(document.location.search));)t.push(n[1]);return t}("hash")[0];function M(){var e=Object(g.useState)({hash:null,name:null}),n=Object(p.a)(e,2),t=n[0],r=n[1];return Object(g.useEffect)(function(){t.name&&t.hash&&x.a.keyboards.put(t)},[t]),Object(v.c)(y.a,{trigger:Object(v.c)("button",{css:{backgroundColor:"#2D2D2D",color:"white",fontSize:20,padding:"10px 20px",marginRight:40,borderRadius:4}},"Save and Share"),modal:!0,position:"right center",onOpen:function(){k.a.sharingFocused=!0,Object(R.b)().then(function(){var e=Object(f.a)(d.a.mark(function e(n){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.keyboards.put({hash:n,name:"my random name"});case 2:r(L({},t,{hash:n}));case 3:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}())},onClose:function(){k.a.sharingFocused=!1,r({hash:null,name:null})},contentStyle:{padding:40,borderRadius:4}},Object(v.c)(m.a.Fragment,null,t.name?t.hash?Object(v.c)("div",null,"Share this link:"," ",Object(v.c)("a",{href:"".concat(window.location,"?hash=").concat(t.hash)},"".concat(window.location,"?hash=").concat(t.hash))):Object(v.c)("div",null,"loading..."):Object(v.c)(j.a,{onComplete:function(e){return r(L({},t,{name:e}))}})))}function U(){var e=Object(g.useState)(!1),n=Object(p.a)(e,2),t=n[0],r=n[1],a=function(){var e=Object(f.a)(d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r(!0),e.next=3,Object(R.a)(K);case 3:window.location=window.location.origin;case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return K?Object(v.c)(y.a,{contentStyle:{padding:40},modal:!0,open:!0},t?Object(v.c)("div",null,"loading..."):Object(v.c)(m.a.Fragment,null,Object(v.c)("div",{css:{marginBottom:20}},"Do you want to replace your existing keyboard with the new one?"),Object(v.c)("button",{onClick:a,css:{marginRight:20}},"Yes!"),Object(v.c)("button",{onClick:function(){window.location=window.location.origin}},"No"))):null}function B(){var e=Object(g.useState)([]),n=Object(p.a)(e,2),t=n[0],r=n[1],a=function(){var e=Object(f.a)(d.a.mark(function e(){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.keyboards.toArray();case 2:n=e.sent,r(n);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return Object(v.c)(y.a,{trigger:Object(v.c)("button",{css:{backgroundColor:"#2D2D2D",color:"white",fontSize:20,padding:"10px 20px",marginRight:40,borderRadius:4}},"Your keyboards"),onOpen:a,contentStyle:{padding:40},modal:!0},Object(v.c)("div",null,t.length>0?Object(v.c)(m.a.Fragment,null,Object(v.c)("h4",null,"Your keyboards:"),Object(v.c)("ul",null,t.map(function(e){var n=e.hash,t=e.name;return Object(v.c)("li",{key:n},Object(v.c)("a",{href:"".concat(window.location,"?hash=").concat(n)},t))}))):null))}window.navigator.mediaDevices.getUserMedia({audio:!0}).then(function(e){k.a.mediaRecorder=new MediaRecorder(e),k.a.mediaRecorder.ondataavailable=function(e){k.a.recording&&k.a.chunks.push(e.data)},k.a.mediaRecorder.onstop=function(){var e=new Blob(k.a.chunks,{type:"audio/ogg; codecs=opus"});k.a.chunks=[],k.a.lastRecordingBlob=e,k.a.lastRecordingURL=window.URL.createObjectURL(e)}}).catch(function(e){return console.error(e)});var N=function(n){function t(){var n;return Object(a.a)(this,t),(n=Object(c.a)(this,Object(i.a)(t).call(this))).downHandler=function(e){var t=e.key;if(!k.a.sharingFocused){var r=h.a.toLower(t);if(h.a.includes(F,r))if(!k.a.pressedKeys[r])if(!h.a.reduce(k.a.pressedKeys,function(e,n,t){return e||n&&r!==t},!1))if(k.a.pressedKeys[r]=!0,n.setState(L({},n.state,{recording:L({},n.state.recording),pressedKeys:L({},n.state.pressedKeys,Object(l.a)({},r,!0))})),r===t)n.playClip(t);else{if(k.a.recording)return;console.log("recording"),k.a.mediaRecorder.start(),k.a.recording=!0}}},n.upHandler=function(t){var r=t.key;if(!k.a.sharingFocused){var a=h.a.toLower(r);if(h.a.includes(F,a)&&k.a.pressedKeys[a]&&(k.a.pressedKeys[a]=!1,n.setState(L({},n.state,{recording:L({},n.state.recording),pressedKeys:L({},n.state.pressedKeys,Object(l.a)({},a,!1))})),k.a.recording)){console.log("saving recording");try{k.a.mediaRecorder.stop()}catch(o){console.warn(o)}e(function(){n.saveClip(a),k.a.recording=!1})}}},n.loadSound=function(e){return new Promise(function(n){var t=new XMLHttpRequest;t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){n(t.response)},t.send()})},n.saveClip=function(){var t=Object(f.a)(d.a.mark(function t(r){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(k.a.lastRecordingURL){t.next=2;break}return t.abrupt("return",e(function(){return n.saveClip(r)}));case 2:return n.setState({recordings:L({},n.state.recordings,Object(l.a)({},r,k.a.lastRecordingURL))}),k.a.lastRecordingURL=null,t.next=6,x.a.keys.put({key:r,blob:k.a.lastRecordingBlob});case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),n.playClip=function(){var e=Object(f.a)(d.a.mark(function e(t){var r,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.state.recordings[t]){e.next=3;break}return e.abrupt("return");case 3:try{k.a.sourceNode&&(k.a.sourceNode.stop(),k.a.sourceNode.disconnect(k.a.analyser))}catch(o){console.warn(o)}return k.a.sourceNode=k.a.audioContext.createBufferSource(),k.a.sourceNode.connect(k.a.analyser),e.next=8,n.loadSound(r);case 8:a=e.sent,k.a.audioContext.decodeAudioData(a,function(e){k.a.sourceNode.buffer=e,k.a.sourceNode.loop=!1,k.a.sourceNode.start(0)},function(e){return console.error(e)});case 10:case"end":return e.stop()}},e)}));return function(n){return e.apply(this,arguments)}}(),n.state={pressedKeys:{},recording:!1,recordings:{},loading:!0},n}return Object(s.a)(t,n),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=Object(f.a)(d.a.mark(function e(){var n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener("keydown",this.downHandler),window.addEventListener("keyup",this.upHandler),e.prev=2,e.next=5,x.a.keys.toArray();case 5:n=e.sent,this.setState({recordings:n.reduce(function(e,n){return e[n.key]=window.URL.createObjectURL(n.blob),e},{})}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:this.setState({loading:!1});case 13:case"end":return e.stop()}},e,this,[[2,9]])}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.downHandler),window.removeEventListener("keyup",this.upHandler)}},{key:"render",value:function(){return this.state.loading?null:this.props.children(this.state)}}]),t}(m.a.Component);n.a=function(){return Object(v.c)(N,null,function(e){var n=e.pressedKeys,t=e.recording,r=e.recordings;return Object(v.c)("div",null,Object(v.c)(v.a,{styles:Object(v.b)(S())}),Object(v.c)(U,null),Object(v.c)("h1",null,"Push to Talk"),Object(v.c)("div",{style:{display:"flex",justifyContent:"center"}},Object(v.c)("div",{css:{padding:40,display:"flex",justifyContent:"flex-start",alignItems:"flex-start",flexDirection:"column"}},Object(v.c)(O.b,null,D.map(function(e,a){return Object(v.c)(O.a,{selected:n[e],hasRecording:!!r[e],isRecording:t,key:e,leftMargin:0!==a,keycode:e})})),Object(v.c)(O.b,{css:{marginLeft:20,marginTop:10}},E.map(function(e,a){return Object(v.c)(O.a,{selected:n[e],hasRecording:!!r[e],isRecording:t,key:e,leftMargin:0!==a,keycode:e})})),Object(v.c)(O.b,{css:{marginLeft:50,marginTop:10,position:"relative"}},P.map(function(e,a){return Object(v.c)(O.a,{selected:n[e],key:e,hasRecording:!!r[e],isRecording:t,leftMargin:0!==a,keycode:e})}),Object(v.c)(O.a,{css:{width:100,position:"absolute",left:"0",transform:"translateX(calc(-100% - 10px))"},selected:!1,hasRecording:!1,isRecording:!1,keycode:"Shift"})))),Object(v.c)(w.a,null),Object(v.c)(M,null),Object(v.c)(B,null))})}}).call(this,t(19).setImmediate)},,,function(e,n,t){"use strict";t.d(n,"a",function(){return g});var r=t(11),a=t(12),o=t(14),c=t(13),i=t(15),s=t(2),u=t.n(s),d=t(0),l=t(1),f=t(25),p=t.n(f),b=t(26),h=t.n(b),g=function(e){function n(){var e;Object(r.a)(this,n),(e=Object(o.a)(this,Object(c.a)(n).call(this))).ref=u.a.createRef();var t=function(){e.ref.current&&(e.ref.current.style.transform="translate(-50%, calc(-50% + ".concat(l.a.mouthPosition,"px))"))};return l.a.analyser.onaudioprocess=function(e){for(var n=e.inputBuffer.getChannelData(0),r=e.outputBuffer.getChannelData(0),a=0;a<n.length;a++)r[a]=n[a],0!==n[a]&&(l.a.mouthPosition=100*Math.abs(n[a]),window.requestAnimationFrame(t))},e}return Object(i.a)(n,e),Object(a.a)(n,[{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){return Object(d.c)("div",{css:{position:"relative",width:300}},Object(d.c)("img",{css:{width:"100%"},src:p.a}),Object(d.c)("img",{ref:this.ref,css:{position:"absolute",width:"100%",top:"50%",left:"50%",transform:"translate(-50%, calc(-50% + ".concat(l.a.mouthPosition,"px))"),transition:"all linear 0.3s",zIndex:9},src:h.a}))}}]),n}(u.a.Component)},function(e,n,t){e.exports=t.p+"static/media/face.f302813b.png"},function(e,n,t){e.exports=t.p+"static/media/mouth.9227568e.png"},function(e,n,t){"use strict";t.d(n,"a",function(){return c});var r=t(6),a=t(2),o=t.n(a);function c(e){var n=Object(a.useState)(""),t=Object(r.a)(n,2),c=t[0],i=t[1];return o.a.createElement(o.a.Fragment,null,o.a.createElement("input",{placeholder:"Your keyboard's name",value:c,onChange:function(e){return i(e.target.value)}}),o.a.createElement("button",{disabled:!c,onClick:function(){return e.onComplete(c)}},"Share keyboard"))}},,function(e,n,t){e.exports=function(){return new Worker(t.p+"08b1b4c3af9fd96811d2.worker.js")}},,function(e,n,t){e.exports=t(40)},,,,,,,,,function(e,n,t){"use strict";t.r(n);var r=t(2),a=t.n(r),o=t(20),c=t.n(o),i=t(21);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(i.a,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[31,1,2]]]);
//# sourceMappingURL=main.e1cf7916.chunk.js.map